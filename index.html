<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Jackson File Manager</title>

<meta name="theme-color" content="#0f9d58">
<link rel="manifest" href="manifest.json">

<style>
  body {
    margin: 0; padding: 0;
    font-family: sans-serif;
    background: #f5f5f5;
    color: #333;
  }
  header {
    padding: 10px;
    background: #0f9d58;
    color: white;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
  }
  header h1 {
    margin: 0;
    font-size: 1.3em;
  }
  button {
    margin: 5px;
    padding: 6px 10px;
    background: white;
    border: none;
    border-radius: 4px;
    color: #0f9d58;
    cursor: pointer;
    font-weight: bold;
  }
  input[type="text"] {
    margin:5px;
    padding:5px;
    border-radius:4px;
    border:none;
    width:150px;
  }
  main {
    padding: 10px;
  }
  h2 {
    margin-top: 20px;
    margin-bottom: 5px;
    color: #0f9d58;
  }
  .fileContainer {
    display: grid;
    grid-template-columns: repeat(auto-fill,minmax(160px,1fr));
    gap: 10px;
  }
  .fileCard {
    background: white;
    padding: 10px;
    border-radius: 6px;
    box-shadow: 0 1px 3px rgba(0,0,0,0.2);
    word-break: break-word;
    display: flex;
    flex-direction: column;
    align-items: center;
    transition: transform 0.2s;
  }
  .fileCard:hover {
    transform: translateY(-2px);
  }
  .preview {
    max-width: 100%;
    max-height: 120px;
    margin-top: 5px;
    border-radius: 4px;
  }
  iframe {
    width: 100%;
    height: 120px;
    border: none;
    margin-top: 5px;
  }
  pre {
    max-height: 120px;
    overflow: auto;
    width:100%;
    background:#eee;
    padding:5px;
    border-radius:4px;
    margin-top:5px;
  }
</style>
</head>
<body>

<header>
  <h1>Jackson File Manager</h1>
  <div>
    <button id="pickImages">Pick Images Folder</button>
    <button id="pickVideos">Pick Videos Folder</button>
    <button id="pickAudios">Pick Audios Folder</button>
    <button id="pickDocuments">Pick Documents Folder</button>
    <input type="text" id="searchBox" placeholder="Search files">
  </div>
</header>

<main>
  <div id="imagesSection">
    <h2>Images</h2>
    <div class="fileContainer" id="imagesContainer"></div>
  </div>
  <div id="videosSection">
    <h2>Videos</h2>
    <div class="fileContainer" id="videosContainer"></div>
  </div>
  <div id="audiosSection">
    <h2>Audios</h2>
    <div class="fileContainer" id="audiosContainer"></div>
  </div>
  <div id="documentsSection">
    <h2>Documents</h2>
    <div class="fileContainer" id="documentsContainer"></div>
  </div>
</main>

<script>
// Service Worker
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('sw.js');
}

// IndexedDB
let db;
const request = indexedDB.open("JacksonFileManagerDB", 2);
request.onupgradeneeded = e => {
  db = e.target.result;
  if(!db.objectStoreNames.contains("files")){
    db.createObjectStore("files", { keyPath: "id", autoIncrement: true });
  }
};
request.onsuccess = e => {
  db = e.target.result;
  loadFiles();
};
request.onerror = e => console.error("DB error:", e);

function saveFile(file, type){
  const tx = db.transaction("files","readwrite");
  const store = tx.objectStore("files");
  store.add({name:file.name, type:type, blob:file});
}

function loadFiles(){
  const tx = db.transaction("files","readonly");
  const store = tx.objectStore("files");
  const req = store.openCursor();
  clearContainers();
  req.onsuccess = e => {
    const cursor = e.target.result;
    if(cursor){
      displayFile(cursor.value);
      cursor.continue();
    }
  };
}

function clearContainers(){
  imagesContainer.innerHTML = "";
  videosContainer.innerHTML = "";
  audiosContainer.innerHTML = "";
  documentsContainer.innerHTML = "";
}

// Display file cards
function displayFile(fileObj){
  const card = document.createElement("div");
  card.className="fileCard";
  card.dataset.name=fileObj.name.toLowerCase();
  const name = document.createElement("p");
  name.textContent=fileObj.name;
  card.appendChild(name);

  if(fileObj.type==="image"){
    const img=document.createElement("img");
    img.src=URL.createObjectURL(fileObj.blob);
    img.className="preview";
    card.appendChild(img);
    imagesContainer.appendChild(card);
  } else if(fileObj.type==="video"){
    const video=document.createElement("video");
    video.src=URL.createObjectURL(fileObj.blob);
    video.controls=true;
    video.className="preview";
    card.appendChild(video);
    videosContainer.appendChild(card);
  } else if(fileObj.type==="audio"){
    const audio=document.createElement("audio");
    audio.src=URL.createObjectURL(fileObj.blob);
    audio.controls=true;
    card.appendChild(audio);
    audiosContainer.appendChild(card);
  } else {
    if(fileObj.name.endsWith(".pdf")){
      const iframe=document.createElement("iframe");
      iframe.src=URL.createObjectURL(fileObj.blob);
      card.appendChild(iframe);
    } else if(fileObj.name.endsWith(".txt")){
      const pre=document.createElement("pre");
      const reader=new FileReader();
      reader.onload=function(e){
        pre.textContent=e.target.result;
      }
      reader.readAsText(fileObj.blob);
      card.appendChild(pre);
    } else {
      const doc=document.createElement("p");
      doc.textContent="ðŸ“„ Document";
      card.appendChild(doc);
    }
    documentsContainer.appendChild(card);
  }
}

// Folder picking
const pickImages = document.getElementById("pickImages");
const pickVideos = document.getElementById("pickVideos");
const pickAudios = document.getElementById("pickAudios");
const pickDocuments = document.getElementById("pickDocuments");

async function pickFiles(type){
  if(window.showDirectoryPicker){
    const dir=await window.showDirectoryPicker();
    for await(const entry of dir.values()){
      if(entry.kind==="file"){
        const file=await entry.getFile();
        saveFile(file,type);
        displayFile({name:file.name,type:type,blob:file});
      }
    }
  } else {
    const input=document.createElement("input");
    input.type="file";
    input.multiple=true;
    input.onchange=e=>{
      [...e.target.files].forEach(file=>{
        saveFile(file,type);
        displayFile({name:file.name,type:type,blob:file});
      });
    }
    input.click();
  }
}

// Button events
pickImages.onclick=()=>pickFiles("image");
pickVideos.onclick=()=>pickFiles("video");
pickAudios.onclick=()=>pickFiles("audio");
pickDocuments.onclick=()=>pickFiles("document");

// Search
const searchBox=document.getElementById("searchBox");
searchBox.addEventListener("input",()=>{
  const query=searchBox.value.toLowerCase();
  document.querySelectorAll(".fileCard").forEach(card=>{
    if(card.dataset.name.includes(query)){
      card.style.display="flex";
    } else {
      card.style.display="none";
    }
  });
});

</script>

</body>
</html>
